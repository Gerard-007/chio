
<header class="header-2">
    <div class="page-header mx-4 mb-0 mt-7 border-radius-xl min-vh-75" id="background-container" style="background-image: url('https://res.cloudinary.com/geetechlab-com/image/upload/v1659898818/nwaben.com/daddy_heaven_3_m0xhos.jpg')">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-6 mt-sm-5 mb-sm-5 mt-xs-5 mb-xs-5">
                    <img class="img-fluid border-radius-lg blur-shadow-image" style="height: 350px; width: 280px;" src="https://res.cloudinary.com/geetechlab-com/image/upload/v1715208690/nwaben.com/chio/Mum_s_pics_0006_tgrodm.jpg">
                </div>
                <div class="col-md-6 mt-md-5 mb-md-5 mt-xs-5 mb-xs-5">
                    <h3 class="text-white">Dr. Mrs. Juliana Chibuogwu Nwazuruoke(Chio)</h3>

                    <h4 class="text-white">1956 - 2024</h4>

                    <small class="text-white">RN, RM, BSc(Nursing), PGD, MSc(Mat. & Child Health Nursing), MSc(Health Edu), PhD(Mat. & Child Health Nursing), FWACN</small>


                    <div class="d-flex justify-content-center mt-3">
                        <small class="text-white px-2">
                            <a href="#tribute_section" id="write_tribute" class="btn btn-info btn-round btn-md">
                                <i class="fa-solid fa-cross" aria-hidden="true"></i> Write a Tribute
                            </a>
                        </small>
                        <small class="text-white px-2">
                            <a href="https://drive.google.com/file/d/1OPkoQBpQAC2vNkQkNbugtQba97Bd8Z2l/view?usp=drive_link" target="_blank" class="btn btn-warning btn-round btn-md">
                                <i class="fa fa-download" aria-hidden="true"></i> Download IV
                            </a>
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>


<section class="pt-5 pb-4" id="tribute_section">
    <div class="container">

        <div class="row justify-content-center">
            <div class="col-md-auto">
                <div class="card card-frame">
                    <div class="card-body">
                        <div>
                            <h5 class="lead text-center mt-3 font-weight-small">
                                "Let the memory of late Dr. Mrs. Juliana Chibuogwu Nwazuruoke(Chio) be with us forever."
                            </h5>

                            <p class="text-center">
                                Born on Jan. 20, 1956<br>
                                Rested in the Lord on April 11, 2024<br>
                            </p>

                            <p class="text-center">
                                - This website was created & administered by: Gerard Nwazuruoke(Son) for the family.
                            </p>
                        </div>
                        <div class="nav-wrapper position-relative end-0">
                            <ul class="nav nav-pills nav-fill rounded-pill flex-row p-1" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link mb-0 px-0 py-1 rounded-pill active" data-bs-toggle="tab" href="#tribute_widget" role="tab" aria-selected="true">
                                        <i class="fa-solid fa-cross fa-lg" style="color: #0053ae;"></i> Tribute
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link mb-0 px-0 py-1 rounded-pill" data-bs-toggle="tab" href="#gallery_widget" role="tab" aria-controls="gallery_widget" aria-selected="false">
                                        <i class="fa-solid fa-photo-film fa-lg" style="color: #b3005e;"></i> Gallery
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link mb-0 px-0 py-1 rounded-pill" data-bs-toggle="tab" href="#biography_widget" role="tab" aria-controls="biography_widget" aria-selected="false">
                                        <i class="fa-solid fa-book fa-lg" style="color: #8c8200;"></i> Biography
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="tab-content tab-space px-0 mx-0">

            <!-- Tribute section -->
            <div class="tab-pane active" id="tribute_widget">

                <section class="py-7">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-8 ms-auto me-auto">
                                <h4 class="text-center mb-5">Leave a Tribute</h4>

                                <% if (isAuthenticated) { %>
                                    <div class="d-flex">
                                        <div>
                                            <a class="author" href="#">
                                                <div class="position-relative">
                                                    <% if (user && user.profile && user.profile.image) { %>
                                                        <img class="avatar rounded-circle shadow" alt="64x64" src="<%= user.profile.image %>">
                                                    <% } else { %>
                                                        <!-- Handle case when there is no user, user.profile, or user.profile.image -->
                                                        <img class="avatar rounded-circle shadow" alt="64x64" src="https://res.cloudinary.com/geetechlab-com/image/upload/v1583147406/nwaben.com/user_azjdde_sd2oje.jpg">
                                                    <% } %>
                                                </div>
                                            </a>
                                        </div>
                                        <div class="ms-3 w-100">
                                            <form id="tribute-form">
                                                <div class="d-flex justify-content-around m-2">
                                                    <input type="radio" class="radio_item"
                                                        value="candle" name="category"
                                                        id="candle" checked>
                                                    <label class="label_item" for="candle">
                                                        <img src="https://img.icons8.com/external-flaticons-lineal-color-flat-icons/64/000000/external-candles-pharmaceutical-flaticons-lineal-color-flat-icons-2.png"/>
                                                        <small class="font-normal">Light a candle</small>
                                                    </label>

                                                    <!--RADIO Flower-->
                                                    <input type="radio" class="radio_item"
                                                        value="flower" name="category"
                                                        id="flower">
                                                    <label class="label_item" for="flower">
                                                        <img src="https://img.icons8.com/color/64/000000/bunch-flowers.png"/>
                                                        <small class="font-normal">Lay a flower</small>
                                                    </label>

                                                    <!--RADIO Note-->
                                                    <input type="radio" class="radio_item"
                                                        value="note" name="category" id="note">
                                                    <label class="label_item" for="note">
                                                        <img src="https://img.icons8.com/color/64/000000/scroll.png"/>
                                                        <small class="font-normal">Leave a note</small>
                                                    </label>
                                                </div>

                                                <textarea class="form-control border-radius-lg" placeholder="Write your tribute here..." rows="4" name="tribute_text" id="tribute_text" required>
                                                </textarea>

                                                <div>
                                                    <button type="submit" class="btn bg-gradient-info float-end mt-2 px-2">
                                                        <i class="fa-solid fa-cross fa-lg" style="color: #0156ab;"></i> Add Tribute
                                                    </button>
                                                    <button type="button" class="btn bg-gradient-dark float-end mt-2 mx-2" data-bs-toggle="modal" data-bs-target="#donation-modal">
                                                        <i class="fa-solid fa-hand-holding-dollar fa-lg" style="color: #24a609;"></i> Donate
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div> <!-- end media-post -->
                                <% } else { %>
                                    <p class="lead text-center">Please click <a href="/auth/login">here</a> to login/register and add your tribute</p>
                                <% } %>


                                <div>
                                    <% if (tributes.length > 1) { %>
                                        <h4 class="text-center mb-4 mt-5"><%= tributes.length %> Tributes</h4>
                                    <% } else if (tributes.length === 1) { %>
                                        <h4 class="text-center mb-4 mt-5">1 Tribute</h4>
                                    <% } else { %>
                                        <h4 class="text-center mb-5 mt-5">No Tributes Yet</h4>
                                        <p class="text-center lead">Be the first to write a tribute for our beloved Dr. Mrs. Juliana Chibuogwu Nwazuruoke</p>
                                    <% } %>

                                    <div id="tributes-list" class="justify-content">
                                        <% for (const tribute of tributes) { %>

                                            <div class="d-flex" id="tribute-<%= tribute._id %>">
                                                <div>
                                                    <a href="#">
                                                        <div class="position-relative">
                                                            <!-- Display the profile image of the user who created the tribute -->
                                                            <% if (tribute.by && tribute.by.profile && tribute.by.profile.image) { %>
                                                                <img class="avatar rounded-circle shadow" src="<%= tribute.by.profile.image %>" alt="<%= tribute.by.full_name %>">
                                                            <% } else { %>
                                                                <img class="avatar rounded-circle shadow" src="https://res.cloudinary.com/geetechlab-com/image/upload/v1583147406/nwaben.com/user_azjdde_sd2oje.jpg" alt="Default User">
                                                            <% } %>
                                                        </div>
                                                    </a>
                                                </div>
                                                <div class="ms-3">
                                                    <div class="d-flex justify-content-between">
                                                        <h6>
                                                            <%= tribute.by.full_name %> 
                                                            <span class="text-muted text-xs tribute-timestamp">· <%= formatDate(tribute.on) %></span>
                                                        </h6>

                                                        <% if (tribute.category === "candle") { %>
                                                            <img class="px-2" src="https://img.icons8.com/external-flaticons-lineal-color-flat-icons/48/000000/external-candles-pharmaceutical-flaticons-lineal-color-flat-icons-2.png"/>
                                                        <% } else if (tribute.category === "flower") { %>
                                                            <img class="px-2" src="https://img.icons8.com/color/48/000000/bunch-flowers.png"/>
                                                        <% } else { %>
                                                            <img class="px-2" src="https://img.icons8.com/color/48/000000/scroll.png"/>
                                                        <% } %>
                                                    </div>

                                                    <!-- Display the tribute text -->
                                                    <p><%= tribute.tribute_text %></p>

                                                    <% if (isAuthenticated) { %>
                                                        <div class="ms-auto text-start mb-3 mt-0">
                                                            <% if (user.is_admin) { %>
                                                                <a href="#" class="btn text-dark px-2 btn-link" rel="tooltip" title="" data-original-title="Reply to Comment">
                                                                    <i class="fa-solid fa-trash-can fa-lg" style="color: #ff1c1c;"></i> Delete
                                                                </a>
                                                            <% } %>
                                                            <!-- <a href="#" class="btn text-danger px-2 btn-link">
                                                                <i class="fas fa-heart"></i> 243
                                                            </a> -->
                                                        </div>
                                                    <% } %>
                                                </div>
                                            </div>
                                        <% } %>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>



            <!-- Gallery section -->
            <div class="tab-pane" id="gallery_widget">
                <section class="py-5">
                    <div class="container">
                        <div class="row">

                            <div class="row justify-content-md-center mb-3">
                                <div class="col-md-8">
                                    <h6 class="text-center">Upload Images</h6>
                                    <% if (isAuthenticated) { %>
                                        <div class="upload-card mb-3">
                                            <div class="upload-form">
                                                <span class="inner">Drag and drop images here or
                                                    <span class="file_select">Browse</span>
                                                    <input name="images" type="file" class="file" multiple accept="image/*" required>
                                                </span>
                                            </div>
                                            <div class="img-container">
                                            </div>
                                        </div>
                                        <button class="btn btn-icon btn-3 btn-info" type="button" id="send_data">
                                            <span class="btn-inner--icon"><i class="fa-solid fa-upload fa-lg"></i></span>
                                            <span class="btn-inner--text">Upload</span>
                                        </button>
                                    <% } else { %>
                                        <p class="lead text-center">Please click <a href="/auth/login">here</a> to login/register and add your tribute</p>
                                    <% } %>
                                </div>
                            </div>

                        </div>
                        <div class="row min-vh-25 gallery-container" id="animated-thumbnails-gallery">
                            <% if (galleries) { %>
                                <% for (const gallery of galleries) { %>
                                    <div class="col-md-3 mb-3 mt-3 gallery-item" data-lg-size="1600-1067" data-src="<%= gallery.image %>" data-sub-html="<h4> Uploaded by <%= gallery.by.full_name%> </h4> <p> <%= gallery.description %> </p>">
                                        <div class="position-relative" style="height: 200px;"> <!-- Set a fixed height for the container -->
                                            <img alt="<%= gallery.by.full_name %>" class="w-100 h-100 border-radius-lg bg-cover img-responsive" src="<%= gallery.image %>"/>
                                            <div class="d-flex justify-content-between">
                                                <button type="button" class="btn badge bg-gradient-info text-white px-2 btn-link position-absolute top-0 start-0 m-1" id="view-gallery-button" data-gallery-id="<%= gallery._id %>">
                                                    <i class="fa-solid fa-eye fa-lg"></i>
                                                </button>
                                                <% if (isAuthenticated) { %>
                                                    <% if (user.is_admin || gallery.by._id.toString() === user._id.toString()) { %>
                                                        <button type="button" class="btn badge bg-gradient-danger text-white px-2 btn-link position-absolute top-0 end-0 m-1" id="delete-gallery-button" data-gallery-id="<%= gallery._id %>">
                                                            <i class="fa-solid fa-trash-can fa-lg"></i>
                                                        </button>
                                                    <% } %>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                </section>
            </div>



            <!-- Bio section -->
            <div class="tab-pane" id="biography_widget">
                <section class=" pt-md-5 pb-md-5 pt-lg-7">
                    <div class="container-fluid">
                        <div class="row justify-content-end">
                            <div class="col-lg-3 mb-lg-0 mb-3">
                                <ul class="nav flex-column bg-white border-radius-lg p-5 position-sticky top-1">
                                    <li class="nav-item">
                                        <a class="nav-link text-dark d-flex align-items-center" data-scroll href="#biography_section">
                                            <div class="icon me-2 mb-1">
                                                <i class="fa fa-history text-info"></i>
                                            </div>
                                            Biography
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-dark d-flex align-items-center" data-scroll href="#education_section">
                                            <div class="icon me-2 mb-1">
                                                <i class="fa fa-book text-info"></i>
                                            </div>
                                            Education
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-dark d-flex align-items-center" data-scroll href="#work_life_section">
                                            <div class="icon me-2 mb-1">
                                                <i class="fa fa-briefcase text-info"></i>
                                            </div>
                                            Work Life
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-dark d-flex align-items-center" data-scroll href="#hyperlinking">
                                            <div class="icon me-2 mb-1">
                                                <i class="fa fa-users text-info"></i>
                                            </div>
                                            Family
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <div class="col-lg-9">
                                <div class="card mb-5">
                                    <div class="card-header bg-gradient-info p-3 position-relative">
                                        <div class="d-flex">
                                            <div>
                                                <a href="javascript:;">
                                                    <div class="position-relative">
                                                        <img class="avatar avatar-xxl rounded-circle shadow" src="https://res.cloudinary.com/geetechlab-com/image/upload/v1715207930/nwaben.com/chio/mum-removebg-preview_2_ybjjvc.png">
                                                    </div>
                                                </a>
                                            </div>

                                            <div class="ms-4 my-auto">
                                                <h5 class="text-white">Dr. Mrs. Juliana Chibuogwu Nwazuruoke(Chio)</h5>
                                                <small class="text-white">1956 - 2024</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body p-5">

                                        <h3 class="mt-5 mb-3" id="biography_section">Biography</h3>
                                        <p>Her bio goes here...</p>


                                        <h3 class="mt-5 mb-3" id="education_section">Education</h3>
                                        <p>Education Section here...</p>


                                        <h3 class="mt-5 mb-3" id="work_life_section">Work Life</h3>
                                        <p>Work life section here...</p>


                                        <h3 class="mt-5 mb-3" id="hyperlinking">Family</h3>
                                        <p>Family Section goes here...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

        </div>
    </div>
</section>



<div class="modal fade" id="donation-modal" tabindex="-1" role="dialog" aria-labelledby="donation-modal" aria-hidden="true">
    <div class="modal-dialog modal-danger modal-dialog-centered modal-" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="modal-title-notification">
                    <i class="fa-solid fa-hand-holding-dollar fa-xl px-2" style="color: #24a609;"></i>
                    Donate Generously
                </h6>
                <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="py-2 px-3 text-center">
                    <form>
                        <div class="form-group">
                            <label for="donation_currency">Select Currency</label>
                            <select class="form-control" id="donation_currency">
                              <option value="NGN" selected>₦(NGN)</option>
                              <option value="USD">$(USD)</option>
                              <option value="EUR">€(EUR)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="donation_amount" class="form-control-label">Donation Amount</label>
                            <input class="form-control" type="number" id="donation_amount" required/>
                        </div>
                        <div class="ms-auto text-end mt-2">
                            <button type="button" class="btn btn-success">
                                <i class="fa-solid fa-shield-halved fa-lg"></i> Donate
                            </button>
                            <button type="button" class="btn btn-link text-danger ml-auto" data-bs-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-success">
                    <i class="fa-solid fa-shield-halved fa-lg"></i> Donate
                </button>
                <button type="button" class="btn btn-link text-danger ml-auto" data-bs-dismiss="modal">Close</button>
            </div> -->
        </div>
    </div>
</div>



<script src="/socket.io/socket.io.js"></script>
<script src="/assets/customs/main.js"></script>



<!--Tribute upload-->
<script>
    // Function to handle form submission
    const handleFormSubmit = async () => {
        try {
            // Capture form data
            const tributeText = document.getElementById('tribute_text').value;
            const category = document.querySelector('input[name="category"]:checked').value;

            // Create an object with the form data
            const formData = {
                tribute_text: tributeText,
                category: category
            };

            // Send the form data to the backend using Axios
            const response = await axios.post('/tribute/create', formData);

            // Handle success
            console.log('Success:', response.data);
            successToast(response.data.status, response.data.message)
        } catch (error) {
            // Handle error
            console.error('Error:', error);
            errorToast(response.data.status, response.data.message)
        }
    };

    // Add event listener to the form submit button
    const form = document.getElementById('tribute-form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent default form submission
        await handleFormSubmit(); // Call handleFormSubmit function
        form.reset(); // Reset the form fields
    });
</script>



<!--Gallery image upload-->
<script type="text/javascript">
    let files = []
    let submit_btn = document.querySelector("#send_data");
    let upload_form = document.querySelector(".upload-form");
    let container = document.querySelector(".img-container");
    let text = document.querySelector(".inner");
    let browse = document.querySelector(".file_select");
    let input = document.querySelector(".upload-form input");

    browse.addEventListener('click', () => input.click());

    input.addEventListener('change', () => {
        let file = input.files;
        for (let i = 0; i < file.length; i++) {
            //check if file already exists and ignore uploading it again
            if ( files.every(e => e.name !== file[i].name)) {
                files.push(file[i])
            }
        }
        //form.reset();
        showImages();
    });

    const showImages = () => {
        let images = '';
        files.forEach((e, i) => {
            images += `
                <div class="img">
                    <img src="${URL.createObjectURL(e)}" alt="">
                    <span onclick="delImage(${i})">&times;</span>
                </div>
            `;
        })
        container.innerHTML = images;
    }

    const delImage = index => {
        files.splice(index, 1);
        showImages();
    }

    // Drag and Drop functionality...
    upload_form.addEventListener('dragover', e => {
        e.preventDefault();
        upload_form.classList.add('dragover');
        text.innerHTML = 'Drop images here';
    });

    upload_form.addEventListener('dragleave', e => {
        e.preventDefault();
        upload_form.classList.remove('dragover');
        text.innerHTML = 'Drag and drop images here or <span class="file_select">Browse</span>';
    });

    upload_form.addEventListener('drop', e => {
        e.preventDefault();
        upload_form.classList.remove('dragover');
        text.innerHTML = 'Drag and drop images here or <span class="file_select">Browse</span>';

        let file = e.dataTransfer.files;
        for (let i = 0; i < file.length; i++) {
            //check if file already exists and ignore uploading it again
            if ( files.every(e => e.name !== file[i].name)) {
                files.push(file[i])
            }
        }
        showImages();
    });


    // Submit to backend...
    submit_btn.addEventListener('click', () => {
        toggleButtonText(true, "send_data");
        let formData = new FormData();

        for(let file of files) {
            console.log(file);
            formData.append('images', file);
        }

        fetch("/gallery/create", {
            method: "POST",
            body: formData  // No need to specify content-type, FormData will set it automatically
        })
        .then(response => response.json()) // Parse response JSON
        .then(data => {
            toggleButtonText(false, "send_data");
            if (data.status === "success") {
                successToast("success", "Image uploaded successfully.")
            }
        })
        .catch(error => {
            toggleButtonText(false, "send_data");
            console.log(error);
            errorToast("error", "Image upload error");
        });
    });

</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.2/lightgallery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.2/plugins/comment/lg-comment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.2/plugins/autoplay/lg-autoplay.min.js"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        let lightGalleryInstance = null; // Variable to store the LightGallery instance
    
        const deleteButtons = document.querySelectorAll('#delete-gallery-button');
        const galleryContainer = document.getElementById('animated-thumbnails-gallery');
    
        deleteButtons.forEach(button => {
            button.addEventListener('click', async function() {
                // Check if LightGallery instance exists and destroy it
                if (lightGalleryInstance) {
                    lightGalleryInstance.destroy();
                    lightGalleryInstance = null;
                }

                const galleryId = button.getAttribute('data-gallery-id');
                console.log(`galleryId: ${galleryId}`);
                try {
                    // Send delete request to backend
                    const response = await axios.delete(`/gallery/${galleryId}`);
                    if (response.data.success) {
                        // Remove gallery item from DOM
                        galleryItem.remove();
                    }
                } catch (error) {
                    console.error('Error deleting gallery item:', error);
                }
            });
        });
    
        const viewButtons = document.querySelectorAll('#view-gallery-button');
        viewButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Check if LightGallery instance already exists
                if (!lightGalleryInstance) {
                    // Create LightGallery instance
                    lightGalleryInstance = lightGallery(galleryContainer, {
                        thumbnail: true,
                        controls: true,
                        download: false,
                        plugins: [lgAutoplay]
                    });
                }
            });
        });
    });
</script>